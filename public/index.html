<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClubHub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            transition: background 0.3s, color 0.3s;
        }

        body.dark {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            color: #f3f4f6;
        }

        body.light {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f0f9ff 100%);
            color: #111827;
        }

        .card {
            border-radius: 1rem;
            padding: 1.5rem;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            border: 1px solid;
        }

        body.dark .card {
            background: rgba(30, 41, 59, 0.6);
            border-color: #334155;
        }

        body.light .card {
            background: rgba(255, 255, 255, 0.9);
            border-color: #e5e7eb;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 30px -5px rgba(0, 0, 0, 0.3);
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1rem;
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(20px);
            margin-bottom: 2rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
        }

        .logo {
            font-size: 1.875rem;
            font-weight: 900;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .nav button {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            padding: 0.625rem 1.25rem;
            border-radius: 0.75rem;
            transition: all 0.3s;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .nav button:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            transform: translateY(-1px);
        }

        .nav button::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            transition: all 0.3s;
            transform: translateX(-50%);
        }

        .nav button:hover::after {
            width: 80%;
        }

        .btn {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 0.75rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.9375rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: width 0.6s, height 0.6s, top 0.6s, left 0.6s;
            transform: translate(-50%, -50%);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: #6b7280;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }

        .btn-danger:hover {
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.6);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);
            transform: translateY(-2px);
        }

        .grid {
            display: grid;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
        }

        .input, .textarea, .select {
            width: 100%;
            padding: 0.875rem 1rem;
            border-radius: 0.75rem;
            border: 2px solid;
            transition: all 0.3s;
            font-size: 0.9375rem;
        }

        body.dark .input, body.dark .textarea, body.dark .select {
            background: rgba(51, 65, 85, 0.5);
            border-color: #475569;
            color: #f3f4f6;
        }

        body.light .input, body.light .textarea, body.light .select {
            background: rgba(249, 250, 251, 0.8);
            border-color: #d1d5db;
            color: #111827;
        }

        .input:focus, .textarea:focus, .select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            max-width: 42rem;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .club-card {
            cursor: pointer;
            transition: all 0.3s;
            overflow: hidden;
        }

        .club-card:hover {
            transform: translateY(-8px) scale(1.02);
        }

        .club-image {
            width: 100%;
            height: 14rem;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .club-card:hover .club-image {
            transform: scale(1.1);
        }

        .avatar {
            width: 6rem;
            height: 6rem;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .stat-card {
            text-align: center;
            padding: 2rem;
            border-radius: 1rem;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border: 2px solid;
            border-color: rgba(59, 130, 246, 0.3);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 1rem;
            font-weight: 600;
            color: #9ca3af;
            margin-top: 0.5rem;
        }

        .hidden {
            display: none !important;
        }

        .login-container {
            max-width: 28rem;
            margin: 5rem auto;
        }

        .title {
            font-size: 2.25rem;
            font-weight: 900;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1.5rem;
        }

        .announcement-item, .event-item, .club-item {
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            transition: all 0.3s;
            border: 1px solid;
        }

        body.dark .announcement-item, body.dark .event-item, body.dark .club-item {
            background: rgba(51, 65, 85, 0.5);
            border-color: #475569;
        }

        body.light .announcement-item, body.light .event-item, body.light .club-item {
            background: rgba(249, 250, 251, 0.9);
            border-color: #e5e7eb;
        }

        .announcement-item:hover, .event-item:hover, .club-item:hover {
            transform: translateX(4px);
            border-color: #3b82f6;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #9ca3af;
            font-size: 1.125rem;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .error, .success {
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            font-weight: 500;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { 
                opacity: 0;
                transform: translateY(-10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #9ca3af;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            .grid-3, .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .nav {
                flex-wrap: wrap;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body class="dark">
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h1 class="logo">ClubHub</h1>
                <button onclick="toggleTheme()" class="btn">🌙</button>
            </div>
            
            <div id="loginError" class="error hidden"></div>
            <div id="loginSuccess" class="success hidden"></div>
            
            <form onsubmit="login(event)">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Email</label>
                    <input type="email" id="loginEmail" class="input" placeholder="your@email.com" required>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Password</label>
                    <input type="password" id="loginPassword" class="input" placeholder="••••••••" required>
                </div>
                
                <button type="submit" id="loginBtn" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>
            
            <p style="text-align: center; margin-top: 1rem; color: #9ca3af; font-size: 0.875rem;">
                Default: AdminLupak@gmail.com / AdminLupak
            </p>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="header card">
            <div class="header-content container">
                <h1 class="logo">ClubHub</h1>
                
                <nav class="nav">
                    <button onclick="showPage('dashboard')">📊 Dashboard</button>
                    <button onclick="showPage('clubs')">🎭 Clubs</button>
                    <button onclick="showPage('profile')">👤 Profile</button>
                    <button onclick="toggleTheme()">🌙</button>
                    <button onclick="logout()" class="btn btn-danger">Logout</button>
                </nav>
            </div>
        </header>

        <main class="container" style="padding-top: 2rem; padding-bottom: 4rem;">
            <!-- Admin Dashboard -->
            <div id="adminDashboard" class="hidden">
                <div class="section-header">
                    <h2 class="title">Admin Dashboard</h2>
                    <span class="badge">Administrator</span>
                </div>
                
                <div class="grid grid-3" style="margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-number" id="statsClubs">0</div>
                        <div class="stat-label">Total Clubs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statsMembers">0</div>
                        <div class="stat-label">Total Members</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statsEvents">0</div>
                        <div class="stat-label">Total Events</div>
                    </div>
                </div>
                
                <div class="grid grid-2">
                    <div class="card">
                        <div class="section-header">
                            <h3 style="font-size: 1.25rem; font-weight: bold;">Quick Actions</h3>
                        </div>
                        <button onclick="openModal('createClub')" class="btn btn-primary" style="width: 100%; margin-bottom: 0.75rem;">➕ Create Club</button>
                        <button onclick="openModal('announcement')" class="btn btn-secondary" style="width: 100%; margin-bottom: 0.75rem;">📢 Post Announcement</button>
                        <button onclick="openModal('event')" class="btn btn-primary" style="width: 100%;">📅 Create Event</button>
                    </div>
                    
                    <div class="card">
                        <div class="section-header">
                            <h3 style="font-size: 1.25rem; font-weight: bold;">Recent Announcements</h3>
                        </div>
                        <div id="adminAnnouncements"></div>
                    </div>
                </div>
            </div>

            <!-- Member Dashboard -->
            <div id="memberDashboard" class="hidden">
                <div class="section-header">
                    <h2 class="title">Member Dashboard</h2>
                    <span class="badge">Member</span>
                </div>
                
                <div class="grid grid-2">
                    <div class="card">
                        <div class="section-header">
                            <h3 style="font-size: 1.25rem; font-weight: bold;">My Clubs</h3>
                        </div>
                        <div id="memberClubs"></div>
                        <button onclick="showPage('clubs')" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">🔍 Browse Clubs</button>
                    </div>
                    
                    <div class="card">
                        <div class="section-header">
                            <h3 style="font-size: 1.25rem; font-weight: bold;">Upcoming Events</h3>
                        </div>
                        <div id="memberEvents"></div>
                    </div>
                    
                    <div class="card">
                        <div class="section-header">
                            <h3 style="font-size: 1.25rem; font-weight: bold;">Announcements</h3>
                        </div>
                        <div id="memberAnnouncements"></div>
                    </div>
                </div>
            </div>

            <!-- Clubs Page -->
            <div id="clubsPage" class="hidden">
                <h2 class="title">Clubs Directory</h2>
                
                <div id="clubsGrid" class="grid grid-3">
                    <div class="loading">Loading clubs</div>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profilePage" class="hidden">
                <h2 class="title">My Profile</h2>
                
                <div class="card" style="max-width: 42rem; margin: 0 auto;">
                    <div style="display: flex; align-items: center; gap: 1.5rem; margin-bottom: 2rem;">
                        <div class="avatar" id="profileAvatar">A</div>
                        <div>
                            <h3 id="profileName" style="font-size: 1.75rem; font-weight: bold; margin-bottom: 0.25rem;">User</h3>
                            <p id="profileEmail" style="color: #9ca3af; margin-bottom: 0.5rem;">email@example.com</p>
                            <span id="profileRole" class="badge">Member</span>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">My Clubs</h4>
                        <div id="profileClubs"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content card" onclick="event.stopPropagation()">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 id="modalTitle" style="font-size: 1.5rem; font-weight: bold;">Modal</h3>
                <button onclick="closeModal()" class="btn" style="padding: 0.5rem 1rem;">✕</button>
            </div>
            
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        // API Configuration - automatically uses your Cloudflare Pages domain
        const API_BASE_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:8788/api'  // For local development
            : '/api';  // For production (Cloudflare Pages)

        let database = {
            clubs: [],
            generalAnnouncements: [],
            generalEvents: []
        };

        let currentUser = null;

        // API Helper
        async function apiCall(endpoint, options = {}) {
            try {
                console.log(`API Call: ${endpoint}`, options);
                
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                
                const data = await response.json();
                console.log(`API Response:`, data);
                
                if (!response.ok) {
                    throw new Error(data.error || `HTTP ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        async function loadInitialData() {
            try {
                const [clubsData, announcementsData, eventsData] = await Promise.all([
                    apiCall('/clubs'),
                    apiCall('/announcements'),
                    apiCall('/events')
                ]);
                
                database.clubs = clubsData.clubs || [];
                database.generalAnnouncements = announcementsData.announcements || [];
                database.generalEvents = eventsData.events || [];
                
                console.log('Loaded data:', database);
            } catch (error) {
                console.error('Failed to load data:', error);
                showMessage('Failed to load data. Please refresh.', 'error');
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark');
            document.body.classList.toggle('light');
        }

        function showMessage(message, type = 'error') {
            const id = type === 'error' ? 'loginError' : 'loginSuccess';
            const el = document.getElementById(id);
            if (el) {
                el.textContent = message;
                el.classList.remove('hidden');
                setTimeout(() => el.classList.add('hidden'), 5000);
            } else {
                alert(message);
            }
        }

        async function login(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');
            
            loginBtn.disabled = true;
            loginBtn.textContent = 'Logging in...';
            
            try {
                const data = await apiCall('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });
                
                currentUser = data.user;
                console.log('Logged in user:', currentUser);
                
                await loadInitialData();
                
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                showPage('dashboard');
            } catch (error) {
                showMessage(error.message || 'Invalid credentials', 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'Login';
            }
        }

        function logout() {
            currentUser = null;
            database = { clubs: [], generalAnnouncements: [], generalEvents: [] };
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }

        function showPage(page) {
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('memberDashboard').classList.add('hidden');
            document.getElementById('clubsPage').classList.add('hidden');
            document.getElementById('profilePage').classList.add('hidden');
            
            if (page === 'dashboard') {
                if (currentUser.role === 'Admin') {
                    document.getElementById('adminDashboard').classList.remove('hidden');
                    renderAdminDashboard();
                } else {
                    document.getElementById('memberDashboard').classList.remove('hidden');
                    renderMemberDashboard();
                }
            } else if (page === 'clubs') {
                document.getElementById('clubsPage').classList.remove('hidden');
                renderClubs();
            } else if (page === 'profile') {
                document.getElementById('profilePage').classList.remove('hidden');
                renderProfile();
            }
        }

        async function renderAdminDashboard() {
            try {
                const statsData = await apiCall('/stats');
                
                document.getElementById('statsClubs').textContent = statsData.stats.totalClubs;
                document.getElementById('statsMembers').textContent = statsData.stats.totalUsers;
                document.getElementById('statsEvents').textContent = statsData.stats.totalEvents;
                
                const announcementsDiv = document.getElementById('adminAnnouncements');
                announcementsDiv.innerHTML = '';
                
                if (database.generalAnnouncements.length > 0) {
                    database.generalAnnouncements.slice(0, 3).forEach(ann => {
                        const div = document.createElement('div');
                        div.className = 'announcement-item';
                        div.innerHTML = `
                            <p style="font-weight: 500;">${ann.text}</p>
                            <p style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.5rem;">📅 ${ann.date}</p>
                        `;
                        announcementsDiv.appendChild(div);
                    });
                } else {
                    announcementsDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">📢</div><p>No announcements yet</p></div>';
                }
            } catch (error) {
                console.error('Failed to render admin dashboard:', error);
            }
        }

        function renderMemberDashboard() {
            const clubsDiv = document.getElementById('memberClubs');
            clubsDiv.innerHTML = '';
            
            if (currentUser.clubs && currentUser.clubs.length > 0) {
                currentUser.clubs.forEach(clubId => {
                    const club = database.clubs.find(c => c.id === clubId);
                    if (club) {
                        const div = document.createElement('div');
                        div.className = 'club-item';
                        div.innerHTML = `
                            <strong>${club.name}</strong>
                            <p style="font-size: 0.875rem; color: #9ca3af; margin-top: 0.25rem;">👥 ${club.members ? club.members.length : 0} members</p>
                        `;
                        clubsDiv.appendChild(div);
                    }
                });
            } else {
                clubsDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">🎭</div><p>You haven\'t joined any clubs yet</p></div>';
            }
            
            const eventsDiv = document.getElementById('memberEvents');
            eventsDiv.innerHTML = '';
            
            if (database.generalEvents.length > 0) {
                database.generalEvents.slice(0, 5).forEach(event => {
                    const div = document.createElement('div');
                    div.className = 'event-item';
                    div.innerHTML = `
                        <p style="font-weight: 600;">📅 ${event.title}</p>
                        <p style="font-size: 0.875rem; color: #9ca3af; margin-top: 0.25rem;">${event.date}</p>
                    `;
                    eventsDiv.appendChild(div);
                });
            } else {
                eventsDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">📅</div><p>No upcoming events</p></div>';
            }
            
            const announcementsDiv = document.getElementById('memberAnnouncements');
            announcementsDiv.innerHTML = '';
            
            if (database.generalAnnouncements.length > 0) {
                database.generalAnnouncements.slice(0, 3).forEach(ann => {
                    const div = document.createElement('div');
                    div.className = 'announcement-item';
                    div.innerHTML = `
                        <p style="font-weight: 500;">${ann.text}</p>
                        <p style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.5rem;">📅 ${ann.date}</p>
                    `;
                    announcementsDiv.appendChild(div);
                });
            } else {
                announcementsDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">📢</div><p>No announcements yet</p></div>';
            }
        }

        function renderClubs() {
            const grid = document.getElementById('clubsGrid');
            grid.innerHTML = '';
            
            if (database.clubs.length === 0) {
                grid.innerHTML = '<div class="empty-state" style="grid-column: 1 / -1;"><div class="empty-state-icon">🎭</div><p>No clubs available yet</p></div>';
                return;
            }
            
            database.clubs.forEach(club => {
                const card = document.createElement('div');
                card.className = 'card club-card';
                card.onclick = () => openClubModal(club);
                card.innerHTML = `
                    <img src="${club.image}" alt="${club.name}" class="club-image" style="border-radius: 0.75rem 0.75rem 0 0; margin: -1.5rem -1.5rem 1rem -1.5rem;">
                    <div>
                        <h3 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">${club.name}</h3>
                        <p style="color: #9ca3af; margin-bottom: 1rem;">${club.description.substring(0, 120)}...</p>
                        <div style="display: flex; align-items: center; gap: 1rem; font-size: 0.875rem;">
                            <span style="color: #9ca3af;">👥 ${club.members ? club.members.length : 0} members</span>
                            <span style="color: #9ca3af;">📅 ${club.events ? club.events.length : 0} events</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function renderProfile() {
            document.getElementById('profileAvatar').textContent = currentUser.email.charAt(0).toUpperCase();
            document.getElementById('profileName').textContent = currentUser.email.split('@')[0];
            document.getElementById('profileEmail').textContent = currentUser.email;
            document.getElementById('profileRole').textContent = currentUser.role;
            
            const clubsDiv = document.getElementById('profileClubs');
            clubsDiv.innerHTML = '';
            
            if (currentUser.clubs && currentUser.clubs.length > 0) {
                currentUser.clubs.forEach(clubId => {
                    const club = database.clubs.find(c => c.id === clubId);
                    if (club) {
                        const div = document.createElement('div');
                        div.className = 'club-item';
                        div.innerHTML = `
                            <strong>${club.name}</strong>
                            <p style="font-size: 0.875rem; color: #9ca3af; margin-top: 0.25rem;">👥 ${club.members ? club.members.length : 0} members</p>
                        `;
                        clubsDiv.appendChild(div);
                    }
                });
            } else {
                clubsDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">🎭</div><p>You haven\'t joined any clubs yet</p></div>';
            }
        }

        function openModal(type) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modalTitle');
            const body = document.getElementById('modalBody');
            
            if (type === 'announcement') {
                title.textContent = '📢 Post Announcement';
                body.innerHTML = `
                    <textarea id="announcementText" class="textarea" rows="6" placeholder="Write your announcement here..." style="margin-bottom: 1rem;"></textarea>
                    <button onclick="postAnnouncement()" class="btn btn-primary" style="width: 100%;">Post Announcement</button>
                `;
            } else if (type === 'event') {
                title.textContent = '📅 Create Event';
                body.innerHTML = `
                    <form onsubmit="createEvent(event)">
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Event Title</label>
                            <input type="text" id="eventTitle" class="input" placeholder="Annual Tech Summit" required>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Date</label>
                            <input type="date" id="eventDate" class="input" required>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Description</label>
                            <textarea id="eventDescription" class="textarea" rows="4" placeholder="Describe the event..." required></textarea>
                        </div>
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Assign to Club</label>
                            <select id="eventClub" class="select">
                                <option value="general">General Event</option>
                                ${database.clubs.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Create Event</button>
                    </form>
                `;
            } else if (type === 'createClub') {
                title.textContent = '➕ Create New Club';
                body.innerHTML = `
                    <form onsubmit="createClub(event)">
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Club Name</label>
                            <input type="text" id="clubName" class="input" placeholder="Photography Club" required>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Description</label>
                            <textarea id="clubDescription" class="textarea" rows="4" placeholder="Describe your club..." required></textarea>
                        </div>
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Image URL</label>
                            <input type="url" id="clubImage" class="input" placeholder="https://example.com/image.jpg" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Create Club</button>
                    </form>
                `;
            }
            
            modal.classList.add('active');
        }

        function openClubModal(club) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modalTitle');
            const body = document.getElementById('modalBody');
            
            title.textContent = club.name;
            
            const isMember = currentUser.clubs && currentUser.clubs.includes(club.id);
            
            body.innerHTML = `
                <img src="${club.image}" alt="${club.name}" style="width: 100%; height: 16rem; object-fit: cover; border-radius: 0.75rem; margin-bottom: 1.5rem;">
                <p style="color: #9ca3af; margin-bottom: 1.5rem; line-height: 1.6;">${club.description}</p>
                
                <div style="margin-bottom: 1.5rem;">
                    <h5 style="font-weight: bold; font-size: 1.125rem; margin-bottom: 0.75rem;">📢 Announcements</h5>
                    ${club.announcements && club.announcements.length > 0 
                        ? club.announcements.map(ann => `
                            <div class="announcement-item">
                                <p style="font-weight: 500;">${ann.text}</p>
                                <p style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.5rem;">📅 ${ann.date}</p>
                            </div>
                        `).join('')
                        : '<p style="color: #9ca3af; font-size: 0.875rem;">No announcements yet</p>'
                    }
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <h5 style="font-weight: bold; font-size: 1.125rem; margin-bottom: 0.75rem;">📅 Events</h5>
                    ${club.events && club.events.length > 0 
                        ? club.events.map(evt => `
                            <div class="event-item">
                                <p style="font-weight: 600;">${evt.title}</p>
                                <p style="font-size: 0.875rem; color: #9ca3af; margin-top: 0.25rem;">${evt.description}</p>
                                <p style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.25rem;">📅 ${evt.date}</p>
                            </div>
                        `).join('')
                        : '<p style="color: #9ca3af; font-size: 0.875rem;">No events scheduled</p>'
                    }
                </div>
                
                ${!isMember 
                    ? `<button onclick="joinClub(${club.id})" class="btn btn-primary" style="width: 100%;">Join Club</button>` 
                    : `<div style="text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 0.75rem; color: #10b981; font-weight: 600;">✓ You are a member of this club</div>`
                }
            `;
            
            modal.classList.add('active');
        }

        function closeModal(event) {
            if (event && event.target.id !== 'modal') return;
            document.getElementById('modal').classList.remove('active');
        }

        async function postAnnouncement() {
            const text = document.getElementById('announcementText').value.trim();
            if (!text) {
                alert('Please enter announcement text');
                return;
            }
            
            try {
                await apiCall('/announcements', {
                    method: 'POST',
                    body: JSON.stringify({ text })
                });
                
                const announcementsData = await apiCall('/announcements');
                database.generalAnnouncements = announcementsData.announcements || [];
                
                closeModal();
                showMessage('Announcement posted successfully!', 'success');
                renderAdminDashboard();
            } catch (error) {
                alert(error.message || 'Failed to post announcement');
            }
        }

        async function createEvent(e) {
            e.preventDefault();
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const description = document.getElementById('eventDescription').value;
            const clubId = document.getElementById('eventClub').value;
            
            try {
                await apiCall('/events', {
                    method: 'POST',
                    body: JSON.stringify({
                        title,
                        date,
                        description,
                        clubId: clubId === 'general' ? null : parseInt(clubId)
                    })
                });
                
                const [eventsData, clubsData] = await Promise.all([
                    apiCall('/events'),
                    apiCall('/clubs')
                ]);
                database.generalEvents = eventsData.events || [];
                database.clubs = clubsData.clubs || [];
                
                closeModal();
                showMessage('Event created successfully!', 'success');
                showPage('dashboard');
            } catch (error) {
                alert(error.message || 'Failed to create event');
            }
        }

        async function createClub(e) {
            e.preventDefault();
            const name = document.getElementById('clubName').value;
            const description = document.getElementById('clubDescription').value;
            const image = document.getElementById('clubImage').value;
            
            try {
                await apiCall('/clubs', {
                    method: 'POST',
                    body: JSON.stringify({ 
                        name, 
                        description, 
                        image,
                        adminId: currentUser.id
                    })
                });
                
                const clubsData = await apiCall('/clubs');
                database.clubs = clubsData.clubs || [];
                
                closeModal();
                showMessage('Club created successfully!', 'success');
                renderAdminDashboard();
            } catch (error) {
                alert(error.message || 'Failed to create club');
            }
        }

        async function joinClub(clubId) {
            try {
                await apiCall(`/clubs/${clubId}/join`, {
                    method: 'POST',
                    body: JSON.stringify({ userId: currentUser.id })
                });
                
                if (!currentUser.clubs) currentUser.clubs = [];
                currentUser.clubs.push(clubId);
                
                const club = database.clubs.find(c => c.id === clubId);
                if (club) {
                    if (!club.members) club.members = [];
                    club.members.push(currentUser.id);
                }
                
                closeModal();
                showMessage(`Successfully joined ${club ? club.name : 'the club'}!`, 'success');
                showPage('dashboard');
            } catch (error) {
                alert(error.message || 'Failed to join club');
            }
        }
    </script>
</body>
</html>